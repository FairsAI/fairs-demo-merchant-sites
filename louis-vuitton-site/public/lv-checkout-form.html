<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Louis Vuitton - Checkout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/assets/fairs-sdk-enhanced.js"></script>
    <style>
        /* Load Futura font from lv-checkout */
        @font-face {
            font-family: 'Futura';
            src: url('/lv-checkout/app/fonts/futurabt-light-webfont.woff2') format('woff2'),
                 url('/lv-checkout/app/fonts/futura-light-bt.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }

        /* Custom fonts and styles with Futura as primary font */
        body {
            font-family: 'Futura', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 300;
            letter-spacing: 0.025em;
            background-color: #f9f9f9;
        }

        /* Enhanced typography with Futura */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Futura', sans-serif;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        .lv-logo {
            height: 24px;
            width: auto;
        }

        /* Form field styling */
        .form-field {
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 12px;
            font-size: 14px;
            background-color: white;
            transition: border-color 0.2s;
        }

        .form-field:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 1px #000;
        }

        .form-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
            display: block;
        }

        /* Ensure dropdowns have white backgrounds */
        select {
            background-color: white !important;
            height: 46px; /* Match form field height (12px padding top + 12px padding bottom + 22px content) */
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }

        select:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 1px #000;
        }

        .fairs-logo {
            height: 15px;
            width: 45px;
            display: inline-block;
        }

        /* Modal styles for the quick checkout */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        /* Override Fairs SDK modal background */
        .fairs-modal-overlay,
        .fairs-checkout-overlay,
        [class*="fairs"] [class*="overlay"],
        [class*="modal"] [class*="overlay"],
        div[style*="background"]:not(.modal-content) {
            background: rgba(255, 255, 255, 0.8) !important;
        }

        /* Additional fallback overrides */
        body > div[style*="position: fixed"][style*="z-index"] {
            background: rgba(255, 255, 255, 0.8) !important;
        }

        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 8px;
            max-width: 425px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white border-b border-gray-200">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <!-- Left Side - Empty for balance -->
            <div class="flex items-center">
            </div>
            
            <!-- Center - Logo -->
            <div class="absolute left-1/2 transform -translate-x-1/2">
                <img src="/lv-checkout/public/louis-vuitton-logo.png" 
                     alt="LOUIS VUITTON" class="lv-logo">
            </div>
            
            <!-- Right Side - Secure Payment & Phone -->
            <div class="flex items-center space-x-6 text-sm">
                <div class="flex items-center">
                    <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                    <span>Secure Payment</span>
                </div>
                <div class="flex items-center">
                    <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                    </svg>
                    <span>Call us at 1.866</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow bg-gray-50">
        <div class="flex flex-col lg:flex-row">
            <!-- Left Column - Checkout Form -->
            <div class="lg:w-2/3 bg-gray-50 px-4 pb-12">
                <div class="max-w-[800px] mx-auto">
                    <form id="checkout-form" class="space-y-8 py-8">
                        <!-- Back Button -->
                        <div class="flex items-center">
                            <button id="back-button" type="button" class="flex items-center text-black">
                                <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- Contact Section -->
                        <div>
                            <h2 class="text-xl font-normal mb-6">Contact</h2>
                            <div class="mb-4">
                                <input type="email" id="email" name="email" 
                                       placeholder="Email" 
                                       class="form-field w-full" required>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="email-offers" name="email-offers" class="mr-2">
                                <label for="email-offers" class="text-sm">Email me with news and offers</label>
                            </div>
                        </div>

                        <!-- Delivery Section -->
                        <div>
                            <h2 class="text-xl font-normal mb-6">Delivery</h2>
                            
                            <div class="mb-4">
                                <select name="country" class="form-field w-full">
                                    <option value="US">United States</option>
                                    <option value="CA">Canada</option>
                                    <option value="UK">United Kingdom</option>
                                </select>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <input type="text" name="firstName" 
                                           placeholder="First name" 
                                           class="form-field w-full" required>
                                </div>
                                <div>
                                    <input type="text" name="lastName" 
                                           placeholder="Last name" 
                                           class="form-field w-full" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <input type="text" name="address" 
                                       placeholder="Address" 
                                       class="form-field w-full" required>
                            </div>

                            <div class="mb-4">
                                <input type="text" name="apartment" 
                                       placeholder="Apartment, suite, etc. (optional)" 
                                       class="form-field w-full">
                            </div>

                            <div class="grid grid-cols-3 gap-4 mb-4">
                                <div>
                                    <input type="text" name="city" 
                                           placeholder="City" 
                                           class="form-field w-full" required>
                                </div>
                                <div>
                                    <select name="state" class="form-field w-full">
                                        <option value="NY">New York</option>
                                        <option value="CA">California</option>
                                        <option value="TX">Texas</option>
                                    </select>
                                </div>
                                <div>
                                    <input type="text" name="zip" 
                                           placeholder="Postal code" 
                                           class="form-field w-full" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <input type="tel" name="phone" 
                                       placeholder="Phone (optional)" 
                                       class="form-field w-full">
                            </div>

                            <div class="flex items-center">
                                <input type="checkbox" id="text-offers" name="text-offers" class="mr-2">
                                <label for="text-offers" class="text-sm">Text me with news and offers</label>
                            </div>
                        </div>

                        <!-- Shipping Method Section -->
                        <div>
                            <h2 class="text-xl font-normal mb-6">Shipping method</h2>
                            <div class="border border-gray-200 rounded-lg mb-4">
                                <div class="p-4 bg-gray-50">
                                    <label class="flex items-center justify-between cursor-pointer">
                                        <div class="flex items-center">
                                            <input type="radio" name="shipping-method" value="standard" checked class="mr-3">
                                            <div>
                                                <span class="font-medium text-sm">STANDARD GROUND (5-7 Business Days)</span>
                                            </div>
                                        </div>
                                        <span class="text-sm font-medium">$10.00</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Section -->
                        <div>
                            <h2 class="text-xl font-normal mb-3">Payment</h2>
                            <div class="flex items-center mb-4">
                                <svg class="h-4 w-4 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                                <p class="text-sm text-gray-500">All transactions are secure and encrypted.</p>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg mb-4">
                                <div class="p-4 bg-white border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <label class="flex items-center">
                                            <input type="radio" name="payment-method" value="card" checked class="mr-2">
                                            <span class="font-medium">Credit or Debit Card</span>
                                        </label>
                                        <div class="flex space-x-2">
                                            <img src="/lv-checkout/public/visa.svg" alt="Visa" class="h-5">
                                            <img src="/lv-checkout/public/mastercard-svgrepo-com.svg" alt="Mastercard" class="h-5">
                                            <img src="/lv-checkout/public/amex.svg" alt="Amex" class="h-5">
                                            <img src="/lv-checkout/public/discover.svg" alt="Discover" class="h-5">
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 space-y-4">
                                    <input type="text" name="cardNumber" 
                                           placeholder="Card number" 
                                           class="form-field w-full" required>
                                    <div class="grid grid-cols-2 gap-4">
                                        <input type="text" name="expiry" 
                                               placeholder="Expiration date (MM / YY)" 
                                               class="form-field w-full" required>
                                        <input type="text" name="cvv" 
                                               placeholder="Security code" 
                                               class="form-field w-full" required>
                                    </div>
                                    <input type="text" name="nameOnCard" 
                                           placeholder="Name on card" 
                                           class="form-field w-full" required>
                                </div>
                            </div>

                            <div class="flex items-center mb-6">
                                <input type="checkbox" id="billing-address" name="billing-address" class="mr-2" checked>
                                <label for="billing-address" class="text-sm">Use shipping address as billing address</label>
                            </div>
                        </div>

                        <!-- Complete Order Button (SDK will inject Remember Me section above this) -->
                        <div>
                            <button id="complete-order-btn" type="submit" class="w-full h-12 rounded-none bg-black hover:bg-gray-900 text-white font-normal flex items-center justify-center mt-6">
                                <span class="flex items-center">Complete order</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Right Column - Order Summary -->
            <div class="lg:w-1/3 bg-white lg:min-h-screen">
                <div class="p-6">
                    <h2 class="text-lg font-normal mb-4">Order Summary</h2>

                    <!-- Order Items -->
                    <div class="mb-6" id="cart-items">
                        <div class="cart-item flex items-center space-x-4 mb-4" data-product-id="M11945" data-product-name="Speedy Soft 30 Crafty" data-price="3400.00" data-quantity="1">
                            <div class="relative">
                                <img src="/lv-checkout/public/speedy-soft-30-crafty.png"
                                     alt="Speedy Soft 30 Crafty" class="product-image w-16 h-16 object-cover rounded">
                                <span class="absolute -top-2 -right-2 bg-gray-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center item-quantity">1</span>
                            </div>
                            <div class="flex-1">
                                <h3 class="product-name font-medium text-sm">Speedy Soft 30 Crafty</h3>
                                <p class="text-xs text-gray-500">Monogram Rouge</p>
                            </div>
                            <span class="price text-sm font-normal">$3,400.00</span>
                        </div>
                        
                        <div class="cart-item flex items-center space-x-4" data-product-id="1A9H2D" data-product-name="Monogram Bloom Belted Dress" data-price="4400.00" data-quantity="1">
                            <div class="relative">
                                <img src="/lv-checkout/public/monogram-bloom-belted-dress.png"
                                     alt="Monogram Bloom Belted Dress" class="product-image w-16 h-16 object-cover rounded">
                                <span class="absolute -top-2 -right-2 bg-gray-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center item-quantity">1</span>
                            </div>
                            <div class="flex-1">
                                <h3 class="product-name text-sm font-normal">Monogram Bloom Belted Dress</h3>
                                <p class="text-xs text-gray-500">Milky White â€¢ Size 34</p>
                            </div>
                            <span class="price text-sm font-normal">$4,400.00</span>
                        </div>
                    </div>

                    <!-- Discount Code -->
                    <div class="mb-6">
                        <div class="flex">
                            <input type="text" placeholder="Discount code or gift card" 
                                   class="form-field flex-1 rounded-r-none border-r-0">
                            <button class="px-4 py-2 bg-gray-100 border border-gray-300 rounded-r text-sm font-medium hover:bg-gray-200">
                                Apply
                            </button>
                        </div>
                    </div>

                    <!-- Order Totals -->
                    <div class="space-y-3" id="order-totals">
                        <div class="flex justify-between">
                            <span class="text-sm">Subtotal</span>
                            <span class="subtotal-price text-sm font-normal" data-amount="7800.00">$7,800.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Shipping</span>
                            <span class="shipping-price text-sm font-normal" data-amount="0.00">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Tax</span>
                            <span class="tax-price text-sm font-normal" data-amount="0.00">$0.00</span>
                        </div>
                        <p class="text-xs text-gray-500">Will be calculated according to your delivery address</p>
                    </div>

                    <hr class="my-4 border-gray-200">

                    <div class="flex justify-between mb-6">
                        <span class="text-base font-normal">Total</span>
                        <span class="total-price text-base font-normal" data-amount="7800.00">$7,800.00</span>
                    </div>

                    <!-- Payment Buttons -->
                    <div class="space-y-3">
                        <!-- Pay with Fairs Button -->
                        <button id="fairs-checkout-button" class="w-full h-12 rounded-none bg-black hover:bg-gray-900 text-white font-normal flex items-center justify-center mb-4">
                            <span class="mr-2">Pay with</span>
                            <img src="/lv-checkout/public/fairs-logo.svg" alt="Fairs" class="fairs-logo" style="filter: brightness(0) invert(1);">
                        </button>
                    </div>

                    <!-- Policy Links -->
                    <div class="mt-6 mb-8 text-center text-xs text-gray-500">
                        <p>By clicking above and placing your order, you agree to Louis Vuitton's 
                        <a href="#" class="underline">Terms & Conditions</a> and acknowledge our 
                        <a href="#" class="underline">Privacy Policy</a>.</p>
                    </div>
                </div>

                <!-- Service Information -->
                <div class="border-t border-gray-200">
                    <div class="py-6 px-6 flex items-start">
                        <div class="mr-4 w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-sm font-normal mb-1">Payment</h3>
                            <p class="text-xs text-gray-500">Credit card, debit card, PayPal, or Apple Pay</p>
                        </div>
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>

                    <div class="py-6 px-6 flex items-start border-t border-gray-200">
                        <div class="mr-4 w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <rect x="1" y="3" width="15" height="13"></rect>
                                <path d="m16 8 2 2-2 2"></path>
                                <path d="m21 12H7"></path>
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-sm font-normal mb-1">Shipping & Delivery</h3>
                            <p class="text-xs text-gray-500">Complimentary Standard Delivery</p>
                        </div>
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>

                    <div class="py-6 px-6 flex items-start border-t border-gray-200">
                        <div class="mr-4 w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                <path d="M21 3v5h-5"></path>
                                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                <path d="M3 21v-5h5"></path>
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-sm font-normal mb-1">Returns & Exchanges</h3>
                            <p class="text-xs text-gray-500">Complimentary</p>
                        </div>
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>

                    <div class="py-6 px-6 flex items-start border-t border-gray-200">
                        <div class="mr-4 w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-sm font-normal mb-1">Next Day Collect-In-Store</h3>
                            <p class="text-xs text-gray-500"></p>
                        </div>
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>

                    <div class="py-6 px-6 flex items-start border-t border-gray-200">
                        <div class="mr-4 w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <polyline points="20,6 9,17 4,12"></polyline>
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-sm font-normal mb-1">Gifting</h3>
                            <p class="text-xs text-gray-500">Discover all the details behind the perfect gift</p>
                        </div>
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8 mt-12">
        <div class="max-w-[1200px] mx-auto px-4 lg:pl-4 lg:pr-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8 lg:ml-0">
                <div>
                    <h3 class="text-sm font-normal mb-4">HELP</h3>
                    <ul class="space-y-2">
                        <li class="text-xs">
                            Our Client Advisors are available to assist you by phone at +1-866-VUITTON, or you may also chat with us.
                        </li>
                        <li class="text-xs underline">FAQs</li>
                        <li class="text-xs underline">Product Care</li>
                        <li class="text-xs underline">Stores</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-normal mb-4">SERVICES</h3>
                    <ul class="space-y-2">
                        <li class="text-xs underline">Repairs</li>
                        <li class="text-xs underline">Personalization</li>
                        <li class="text-xs underline">Art of Gifting</li>
                        <li class="text-xs underline">Download our Apps</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-normal mb-4">ABOUT LOUIS VUITTON</h3>
                    <ul class="space-y-2">
                        <li class="text-xs underline">Fashion Shows</li>
                        <li class="text-xs underline">Arts & Culture</li>
                        <li class="text-xs underline">La Maison</li>
                        <li class="text-xs underline">Sustainability</li>
                        <li class="text-xs underline">Latest News</li>
                        <li class="text-xs underline">Careers</li>
                        <li class="text-xs underline">Foundation Louis Vuitton</li>
                    </ul>
                </div>
            </div>

            <div class="flex flex-col md:flex-row justify-between items-start md:items-center pt-8 border-t border-gray-200 lg:ml-0">
                <div class="flex items-center mb-4 md:mb-0">
                    <span class="text-xs mr-2">Ship to:</span>
                    <img src="/lv-checkout/public/us-flag.svg" alt="US Flag" style="width: 20px; height: 15px; display: inline-block; margin-right: 8px;">
                    <span class="text-xs">United States of America</span>
                </div>
                <div class="flex flex-wrap gap-x-4 gap-y-2">
                    <span class="text-xs">Sitemap</span>
                    <span class="text-xs">Legal Notices</span>
                    <span class="text-xs">Privacy Policy</span>
                    <span class="text-xs">California Supply Chains Act</span>
                    <span class="text-xs">Do Not Sell or Share My Personal Information</span>
                    <span class="text-xs">Accessibility</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced SDK auto-initializes - no need to call init
        // The SDK is available as window.FairsSDK

        // Test data for LV checkout (will be extracted dynamically by SDK)
        const TEST_DATA = {
            cart: {
                total: 7800.00,
                items: [
                    {
                        id: 'M11945',
                        name: 'Speedy Soft 30 Crafty',
                        price: 3400.00,
                        quantity: 1,
                        color: 'Monogram Rouge',
                        material: 'Monogram'
                        // Image will be found dynamically by SDK extractor
                    },
                    {
                        id: '1A9H2D',
                        name: 'Monogram Bloom Belted Dress',
                        price: 4400.00,
                        quantity: 1,
                        color: 'Milky White',
                        size: '34'
                        // Image will be found dynamically by SDK extractor
                    }
                ]
            }
        };

        // Function to collect form data for SDK
        function collectFormData() {
            return {
                email: document.querySelector('input[name="email"]')?.value || '',
                phone: document.querySelector('input[name="phone"]')?.value || document.querySelector('input[name="mobile"]')?.value || '',
                firstName: document.querySelector('input[name="firstName"]')?.value || '',
                lastName: document.querySelector('input[name="lastName"]')?.value || '',
                address: {
                    line1: document.querySelector('input[name="address"]')?.value || '',
                    line2: document.querySelector('input[name="apartment"]')?.value || '',
                    city: document.querySelector('input[name="city"]')?.value || '',
                    state: document.querySelector('select[name="state"]')?.value || '',
                    postalCode: document.querySelector('input[name="zip"]')?.value || '',
                    country: document.querySelector('select[name="country"]')?.value || ''
                }
            };
        }

        // Function to check if user exists in Fairs system
        async function checkUserRecognition(email) {
            try {
                console.log('[LV Checkout Form] ðŸ” Checking database for user:', email);
                
                // Make direct API call to the identity lookup endpoint (like Test 4)
                const response = await fetch('/api/identity/lookup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        lookupType: 'email'
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('[LV Checkout Form] ðŸ“¦ API Response:', result);
                    
                    if (result.success && result.user) {
                        console.log('[LV Checkout Form] ðŸŽ‰ User found in database:', result.user.email);
                        
                        // Convert database user to our format
                        const userData = {
                            email: result.user.email,
                            firstName: result.user.name ? result.user.name.split(' ')[0] : '',
                            lastName: result.user.name ? result.user.name.split(' ').slice(1).join(' ') : '',
                            name: result.user.name || '',
                            phone: result.user.phone || '',
                            address: {
                                line1: '123 Main St', // Mock address data
                                line2: '',
                                city: 'New York',
                                state: 'NY', 
                                postalCode: '10001',
                                country: 'US'
                            },
                            cardLast4: result.user.cardLast4 || '1111',
                            universalId: result.user.universalId
                        };
                        
                        // Store in localStorage for SDK compatibility
                        localStorage.setItem('fairs_user_data', JSON.stringify(userData));
                        localStorage.setItem('fairs_xmid', userData.universalId);
                        
                        console.log('[LV Checkout Form] âœ… User data stored for SDK compatibility');
                        return userData;
                    } else {
                        console.log('[LV Checkout Form] ðŸ” No user found in database for:', email);
                        return null;
                    }
                } else {
                    console.error('[LV Checkout Form] âŒ API request failed:', response.status, response.statusText);
                    return null;
                }
                
            } catch (error) {
                console.error('[LV Checkout Form] âŒ Error checking user recognition:', error);
                return null;
            }
        }

        // Function to create Fairs account using Enhanced SDK
        async function createFairsAccount(userData) {
            console.log('[LV Checkout Form] ðŸ” Creating Fairs account via Enhanced SDK for:', userData.email);
            
            try {
                // Check if Enhanced SDK is available
                if (!window.FairsSDK) {
                    console.error('[LV Checkout Form] âŒ Enhanced SDK not available');
                    return false;
                }

                // Extract user data from form if not provided
                if (!userData.firstName || !userData.lastName) {
                    const extractedData = window.FairsSDK.extractUserDataFromForm();
                    userData = { ...extractedData, ...userData };
                }

                // Use Enhanced SDK to create user
                const result = await window.FairsSDK.createUser(userData, true);

                if (result.success) {
                    console.log('[LV Checkout Form] âœ… User created successfully via Enhanced SDK:', result.user);
                    
                    // Show success message
                    showSuccessMessage('Account created! You can now enjoy faster checkout with Fairs.');
                    
                    return true;
                } else if (result.skipped) {
                    console.log('[LV Checkout Form] â­ï¸ User creation skipped:', result.reason);
                    return false;
                } else {
                    console.error('[LV Checkout Form] âŒ User creation failed:', result.error);
                    showErrorMessage('Account creation failed: ' + result.error);
                    return false;
                }

            } catch (error) {
                console.error('[LV Checkout Form] âŒ Error creating Fairs account:', error);
                showErrorMessage('Account creation failed: Network error');
                return false;
            }
        }

        // Function to show success messages
        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #10b981;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                font-size: 14px;
                max-width: 300px;
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // Function to show error messages
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #ef4444;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                font-size: 14px;
                max-width: 300px;
            `;
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Function to handle email input changes for user recognition
        function handleEmailChange() {
            const emailInput = document.querySelector('input[name="email"]');
            if (!emailInput) return;

            emailInput.addEventListener('blur', async function() {
                const email = this.value.trim();
                if (email && email.includes('@')) {
                    console.log('[LV Checkout Form] ðŸ” Checking email recognition for:', email);
                    
                    const recognizedUser = await checkUserRecognition(email);
                    if (recognizedUser) {
                        console.log('[LV Checkout Form] ðŸŽ‰ User recognized! Auto-opening Fairs modal...');
                        
                        // Auto-fill form with recognized user data
                        if (recognizedUser.firstName) {
                            const firstNameInput = document.querySelector('input[name="firstName"]');
                            if (firstNameInput) firstNameInput.value = recognizedUser.firstName;
                        }
                        if (recognizedUser.lastName) {
                            const lastNameInput = document.querySelector('input[name="lastName"]');
                            if (lastNameInput) lastNameInput.value = recognizedUser.lastName;
                        }
                        if (recognizedUser.phone) {
                            const phoneInput = document.querySelector('input[name="phone"]');
                            if (phoneInput) phoneInput.value = recognizedUser.phone;
                        }
                        if (recognizedUser.address) {
                            if (recognizedUser.address.line1) {
                                const addressInput = document.querySelector('input[name="address"]');
                                if (addressInput) addressInput.value = recognizedUser.address.line1;
                            }
                            if (recognizedUser.address.city) {
                                const cityInput = document.querySelector('input[name="city"]');
                                if (cityInput) cityInput.value = recognizedUser.address.city;
                            }
                            if (recognizedUser.address.postalCode) {
                                const zipInput = document.querySelector('input[name="zip"]');
                                if (zipInput) zipInput.value = recognizedUser.address.postalCode;
                            }
                        }

                        // Auto-open Fairs modal after a short delay
                        setTimeout(() => {
                            const fairsButton = document.getElementById('fairs-checkout-button');
                            if (fairsButton) {
                                fairsButton.click();
                            }
                        }, 1500);
                    }
                }
            });
        }

        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[LV Checkout Form] ðŸ”„ DOM loaded, initializing...');

            // The Enhanced SDK will auto-inject fields automatically - no manual initialization needed
            console.log('[LV Checkout Form] ðŸŽ¯ Enhanced SDK auto-injection will handle field injection automatically');

            // Handle email input changes for user recognition
            handleEmailChange();

            // Add a helper function to create test data for demonstration
            window.createTestUser = function() {
                const testUser = {
                    email: 'jane.smith@example.com',
                    firstName: 'Jane',
                    lastName: 'Smith',
                    name: 'Jane Smith',
                    phone: '555-123-4567',
                    address: {
                        line1: '456 Main St',
                        line2: '',
                        city: 'Portland',
                        state: 'OR',
                        postalCode: '97218',
                        country: 'US'
                    },
                    cardLast4: '1111'
                };
                
                createFairsAccount(testUser);
                console.log('[LV Checkout Form] ðŸ§ª Test user created:', testUser.email);
                console.log('[LV Checkout Form] ðŸ’¡ Try entering "jane.smith@example.com" in the email field!');
                return testUser;
            };

            // Log helpful instructions
            console.log('[LV Checkout Form] ðŸ’¡ Demo Instructions:');
            console.log('[LV Checkout Form] ðŸ“§ Try these ACTUAL database emails for instant recognition:');
            console.log('[LV Checkout Form]   â€¢ test@example.com');
            console.log('[LV Checkout Form]   â€¢ steve@stevey.com');
            console.log('[LV Checkout Form]   â€¢ bruce@labruce.com');
            console.log('[LV Checkout Form]   â€¢ bill@billerson.com');
            console.log('[LV Checkout Form]   â€¢ wilson@wilson.com');
            console.log('[LV Checkout Form]   â€¢ pickle@pickle.com');
            console.log('[LV Checkout Form] ðŸ”§ Or run window.createTestUser() to create localStorage test data');
            console.log('[LV Checkout Form] âœ… Check "Save my information" checkbox and click Complete Order to create a new Fairs account');
            console.log('[LV Checkout Form] ðŸ”— Using direct API calls to /api/identity/lookup for user recognition');

            // Add event handler for Pay with Fairs button
            const fairsButton = document.getElementById('fairs-checkout-button');
            if (fairsButton) {
                fairsButton.addEventListener('click', async function() {
                    console.log('[LV Checkout Form] Pay with Fairs button clicked');
                    
                    // Collect current form data
                    const customerData = collectFormData();
                    
                    // Open Fairs checkout modal
                    console.log('[LV Checkout Form] ðŸš€ Opening checkout modal...');
                    try {
                        // Format checkout data properly
                        const checkoutData = {
                            order: {
                                id: `lv_order_${Date.now()}`,
                                total: TEST_DATA.cart.total,
                                currency: 'USD',
                                items: TEST_DATA.cart.items
                            },
                            customer: customerData,
                            onSuccess: function(result) {
                                console.log('[LV Checkout Form] âœ… Payment successful:', result);
                                alert(`ðŸŽ‰ Payment successful! \nTransaction ID: ${result.transactionId}\nAmount: $${result.amount}`);
                            },
                            onCancel: function() {
                                console.log('[LV Checkout Form] âŒ Payment cancelled');
                            },
                            onError: function(error) {
                                console.log('[LV Checkout Form] ðŸ’¥ Payment error:', error);
                                alert('Payment failed. Please try again.');
                            },
                            onPopupOpen: function() {
                                console.log('[LV Checkout Form] ðŸ“¦ Modal opened');
                            },
                            onVerificationRequest: function() {
                                console.log('[LV Checkout Form] ðŸ“± Verification requested');
                            },
                            onVerificationComplete: function(result) {
                                console.log('[LV Checkout Form] âœ”ï¸ Verification completed:', result);
                            },
                            onFormValidation: function(result) {
                                console.log('[LV Checkout Form] ðŸ“‹ Form validation:', result.valid ? 'VALID' : 'INVALID');
                            },
                            onClose: function(reason) {
                                console.log('[LV Checkout Form] ðŸšª Modal closed:', reason);
                            }
                        };

                        // Use enhanced SDK checkout functionality
                        const modal = window.FairsSDK.checkout.open(checkoutData);
                        console.log('[LV Checkout Form] ðŸ“‹ Modal created:', !!modal);
                    } catch (error) {
                        console.error('[LV Checkout Form] âŒ Error opening checkout:', error);
                        alert('Error opening checkout: ' + error.message);
                    }
                });
            } else {
                console.error('[LV Checkout Form] âŒ Pay with Fairs button not found!');
            }

            // Add event handler for back button
            const backButton = document.getElementById('back-button');
            if (backButton) {
                backButton.addEventListener('click', function() {
                    console.log('[LV Checkout Form] Back button clicked');
                    // Navigate back to shopping cart
                    window.location.href = '/test-1-lv-checkout.html';
                });
            }

            // Add event handler for Complete Order button
            const completeOrderButton = Array.from(document.querySelectorAll('button')).find(btn => btn.textContent.includes('Complete order'));
            
            if (completeOrderButton) {
                completeOrderButton.addEventListener('click', async function(e) {
                    e.preventDefault();
                    console.log('[LV Checkout Form] Complete Order button clicked');
                    
                    // Check if "Save my information" checkbox is checked (using correct selector for injected checkbox)
                    const saveInfoCheckbox = document.querySelector('input[name="save_account"]') || document.querySelector('input[name="save-info"]');
                    const isSaveInfoChecked = saveInfoCheckbox && saveInfoCheckbox.checked;
                    
                    console.log('[LV Checkout Form] Save info checkbox found:', !!saveInfoCheckbox);
                    console.log('[LV Checkout Form] Save info checkbox checked:', isSaveInfoChecked);
                    
                    if (isSaveInfoChecked) {
                        // Collect form data
                        const formData = collectFormData();
                        
                        // Validate required fields
                        if (!formData.email || !formData.firstName || !formData.lastName) {
                            showErrorMessage('Please fill in all required fields (Email, First Name, Last Name)');
                            return;
                        }
                        
                        // Check for mobile phone number (using correct selector for injected phone field)
                        const mobileInput = document.querySelector('input[name="mobile_phone"]') || document.querySelector('input[name="mobile"]');
                        const mobilePhone = mobileInput ? mobileInput.value.trim() : '';
                        
                        console.log('[LV Checkout Form] Mobile input found:', !!mobileInput);
                        console.log('[LV Checkout Form] Mobile phone value:', mobilePhone || '(empty)');
                        
                        if (!mobilePhone) {
                            showErrorMessage('Please enter your mobile phone number to create a Fairs account for faster checkout.');
                            if (mobileInput) mobileInput.focus();
                            return;
                        }
                        
                        // Create comprehensive user data object
                        const userData = {
                            email: formData.email,
                            firstName: formData.firstName,
                            lastName: formData.lastName,
                            name: `${formData.firstName} ${formData.lastName}`,
                            phone: mobilePhone, // Use mobile phone specifically
                            address: formData.address
                        };
                        
                        console.log('[LV Checkout Form] ðŸ”„ Attempting to create Fairs account with data:', userData);
                        
                        try {
                            // Create Fairs account using Enhanced SDK
                            const accountCreated = await createFairsAccount(userData);
                            
                            // Generate order number
                            const orderNumber = `LV-${Math.floor(Math.random() * 1000000)}`;
                            
                            if (accountCreated) {
                                // Show success message with Fairs account
                                setTimeout(() => {
                                    alert(`ðŸŽ‰ Order completed successfully! \n\n` +
                                          `Order #: ${orderNumber}\n` +
                                          `Total: $${TEST_DATA.cart.total.toFixed(2)}\n\n` +
                                          `âœ… You've been enrolled in Fairs Express Checkout!\n` +
                                          `Next time you shop, you'll be recognized for faster checkout.`);
                                }, 100);
                                
                                console.log('[LV Checkout Form] âœ… Order completed with Fairs account creation');
                            } else {
                                // Account creation failed, but complete order anyway
                                setTimeout(() => {
                                    alert(`ðŸŽ‰ Order completed successfully! \n\n` +
                                          `Order #: ${orderNumber}\n` +
                                          `Total: $${TEST_DATA.cart.total.toFixed(2)}\n\n` +
                                          `âš ï¸ Fairs account creation was unsuccessful, but your order is confirmed.`);
                                }, 100);
                                
                                console.log('[LV Checkout Form] âœ… Order completed despite Fairs account creation failure');
                            }
                        } catch (error) {
                            console.error('[LV Checkout Form] âŒ Error during account creation:', error);
                            
                            // Complete order even if account creation fails
                            const orderNumber = `LV-${Math.floor(Math.random() * 1000000)}`;
                            setTimeout(() => {
                                alert(`ðŸŽ‰ Order completed successfully! \n\n` +
                                      `Order #: ${orderNumber}\n` +
                                      `Total: $${TEST_DATA.cart.total.toFixed(2)}\n\n` +
                                      `âš ï¸ There was an issue setting up your Fairs account, but your order is confirmed.`);
                            }, 100);
                            
                            console.log('[LV Checkout Form] âœ… Order completed with Fairs account creation error handled');
                        }
                    } else {
                        // Complete order without Fairs account creation
                        const orderNumber = `LV-${Math.floor(Math.random() * 1000000)}`;
                        alert(`ðŸŽ‰ Order completed successfully! \n\n` +
                              `Order #: ${orderNumber}\n` +
                              `Total: $${TEST_DATA.cart.total.toFixed(2)}\n\n` +
                              `Thank you for your purchase!`);
                        
                        console.log('[LV Checkout Form] âœ… Order completed without Fairs opt-in');
                    }
                });
            } else {
                console.error('[LV Checkout Form] âŒ Complete Order button not found!');
            }

            console.log('[LV Checkout Form] âœ… Page loaded with cart total: $' + TEST_DATA.cart.total);
            console.log('[LV Checkout Form] ðŸ”§ Fairs SDK available:', typeof window.FairsSDK !== 'undefined');

            // Add form submission handler for the new checkout form
            const checkoutForm = document.getElementById('checkout-form');
            if (checkoutForm) {
                checkoutForm.addEventListener('submit', function(e) {
                    e.preventDefault(); // Prevent default form submission
                    console.log('[LV Checkout Form] Form submitted - triggering Complete Order logic');
                    
                    // Trigger the same logic as the button click
                    const completeOrderButton = document.getElementById('complete-order-btn');
                    if (completeOrderButton) {
                        completeOrderButton.click();
                    }
                });
            }
        });
    </script>
</body>
</html> 